---
title: "ED_bulimia_purging_code"
author: Zhaoying YU
output: html_document
date: "2023-11-07"
---

## Set-up

```{r}
library("dplyr")
library("tidyverse")
library("summarytools")
```

## Import data
```{r}
MHQ2 <-
readRDS("/Users/lilian/Desktop/MHQ2_Anonymous.rds")
```

##Sanity Checks
```{r}
#Ever had recurrent episodes of excessive overeating or binge eating
#Expecting 149,732 for 'No' (0)
MHQ2 %>%
  freq(`29132-0.0`)

#Longest amount of time that overate or binge ate at least once a week
#Expecting 2,479 for 'At least 3 months' (0)
MHQ2 %>%
  freq(`29133-0.0`)

#Experienced episodes of overeating/binge eating during time(s) of low weight
#Expecting 241 for 'Only at time(s) of low weight' (0)
MHQ2 %>%
  freq(`29134-0.0`)

#Frequency of feeling had no control over eating during episodes of overeating/binge eating
#Expecting 3,904 for 'At least once a week for at least 3 months' (0)
MHQ2 %>%
  freq(`29135-0.0`)

#Distress about episodes of overeating/binge eating
#Expecting 8,446 for 'No' (0)
MHQ2 %>%
  freq(`29137-0.0`)

#Methods of controlling body shape or weight when overeating/binge eating
#Expecting 1,124 for 'None of above' (0)
MHQ2 %>%
  freq(`29140-0.0`)

#Frequency of using methods of controlling body shape or weight when overeating/binge eating
#Expecting 780 for 'No' (0)
MHQ2 %>%
  freq(`29141-0.0`)

#Longest amount of time that engaged in these behaviours when overeating/binge eating
#Expecting 749 for 'At least 3 months' (0)
MHQ2 %>%
  freq(`29142-0.0`)

#Dependency of self-esteem on body shape or weight when overeating/binge eating
#Expecting 7,384 for 'None at all or very little' (0)
MHQ2 %>%
  freq(`29143-0.0`)

#	Control of body weight outside of periods of low weight or regular overeating/binge eating
#Expecting 166,046 for 'No' (0)
MHQ2 %>%
  freq(`29144-0.0`)

#Longest amount of time that engaged in these behaviours outside of periods of low weight or overeating/binge eating
#Expecting 1,606 for 'At least 3 months' (0)
MHQ2 %>%
  freq(`29145-0.0`)

#Dependency of self-esteem on body shape or weight
#Expecting 352 for 'None at all or very little' (0)
MHQ2 %>%
  freq(`29146-0.0`)
```

## Algorithms
# Bulimia Nervosa

Ever had recurrent episodes of excessive overeating or binge eating = 2 Yes, at least once a week 
> '29132-0.0' == 2

AND 
Longest amount of time that overate or binge ate at least once a week = 0 At least three months 
>'29133-0.0' == 0

AND
    Experienced episodes of overeating/binge eating during time(s) of low weight = 1 Both, 2 Only at times when I was not at low weight or -4 not underweight 
    >'29134-0.0' %in% c(1,2,-4)

  OR 
    Experienced episodes of overeating/binge eating during time(s) of low weight = 0 Only at time(s) of low weight
    >'29134-0.0' == 0
    
    AND 
    NOT Case {Extended anorexia phenotype} 
    >Extended_AN == 0

AND 
Frequency of feeling had no control over eating during episodes of overeating/binge eating = 0 At least once a week for at least three months 
>'29135-0.0' == 0

AND 
Distress about episodes of overeating/binge eating) = 1 Yes 
>'29137-0.0' == 1

AND 
Methods of controlling body shape or weight when overeating/binge eating = 1 Made yourself vomit OR  2 Used laxatives (pills or liquids meant to stimulate bowel movements) OR 3 Used diuretics (water pills) OR 4 Used weight loss pills (over the counter or prescription) OR 5 Exercised excessively, felt compelled to exercise, felt uneasy or distressed if unable to exercise or prioritised exercise over your health or important activities OR 6 Fasted or not eaten for eight waking hours or more OR 7 Used other methods to lose weight/stay at low weight) 
>'29140-0.0' %in% c(1,2,3,4,5,6,7)

AND 
Frequency of using methods of controlling body shape or weight when overeating/binge eating = 1 Yes, at least once a week 
>'29141-0.0' == 1

AND 
Longest amount of time that engaged in these behaviours when overeating/binge eating = 0 At least three months 
>'29142-0.0' == 0

AND 
Dependency of self-esteem on body shape or weight when overeating/binge eating = 2 A great deal OR 1 A moderate amount
>'29143-0.0' %in% c(1,2)

```{r}
MHQ2 <- MHQ2 %>%
  mutate(bulimia_nervosa_DSM5_algorithm = 
            #HEver had recurrent episodes of excessive overeating or binge eating = 2 Yes, at least once a week 
           case_when(`29132-0.0` == 2 &

            #Longest amount of time that overate or binge ate at least once a week = 0 At least three months 
                     `29133-0.0` == 0 &

            #Experienced episodes of overeating/binge eating during time(s) of low weight = 1 Both, 2 Only at times when I was not at low weight or -4 not underweight
                     (`29134-0.0` %in% c(1,2,-4) |

            #Experienced episodes of overeating/binge eating during time(s) of low weight = 0 Only at time(s) of low weight
                        (`29134-0.0` == 0 &

            #NOT Case {Extended anorexia phenotype} 
                         Extended_AN == 0)) &

            #Frequency of feeling had no control over eating during episodes of overeating/binge eating = 0 At least once a week for at least three months
                     `29135-0.0` == 0 &

            #Distress about episodes of overeating/binge eating) = 1 Yes
                     `29137-0.0` == 1 &

            #Methods of controlling body shape or weight when overeating/binge eating = 1 Made yourself vomit OR  2 Used laxatives (pills or liquids meant to stimulate bowel movements) OR 3 Used diuretics (water pills) OR 4 Used weight loss pills (over the counter or prescription) OR 5 Exercised excessively, felt compelled to exercise, felt uneasy or distressed if unable to exercise or prioritised exercise over your health or important activities OR 6 Fasted or not eaten for eight waking hours or more OR 7 Used other methods to lose weight/stay at low weight) 
                     `29140-0.0` %in% c(1,2,3,4,5,6,7) &

            #Frequency of using methods of controlling body shape or weight when overeating/binge eating = 1 Yes, at least once a week
                     `29141-0.0` == 1 &

            #Longest amount of time that engaged in these behaviours when overeating/binge eating = 0 At least three months
                     `29142-0.0` == 0 &

            #Dependency of self-esteem on body shape or weight when overeating/binge eating = 2 A great deal OR 1 A moderate amount
                     `29143-0.0` %in% c(1,2)
             ~ 1,
            TRUE ~ 0
           )
         )
```

# Extended purging phenotype
Control of body weight outside of periods of low weight or regular overeating/binge eating = 1 Yes, at least once a week
>'29144-0.0' == 1

```{r}
#Extended purging phenotype
MHQ2 <- MHQ2 %>%
  mutate(Extended_purg = 
           case_when(`29144-0.0` == 1 ~ 1,
                     TRUE ~ 0)
  )
```

# Purging disorder
Control of body weight outside of periods of low weight or regular overeating/binge eating = 1 Yes, at least once a week
>'29144-0.0' == 1

AND
Longest amount of time that engaged in these behaviours outside of periods of low weight or overeating/binge eating = 0 At least three months
>'29145-0.0' == 0

AND
During the time when you were engaging in these behaviours, how dependent was your self-worth on your body shape or weight? (EP11c) = 02 A great deal OR 01 A moderate amount
>'29143-0.0' %in% c(1,2)

```{r}
#Purging disorder
MHQ2 <- MHQ2 %>%
  mutate(Purging = 
           case_when(`29144-0.0` == 1 &
                     `29145-0.0` == 0 &
                     `29143-0.0` %in% c(1,2)
           ~ 1,
        TRUE ~ 0
        )
  )
```
