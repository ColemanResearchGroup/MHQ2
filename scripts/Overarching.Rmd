---
title: "Overarching Script"
author: "Johan Zvrskovec"
date: '2023-12-20'
output: html_document
---

This is the overarching script. It works as a wrapper around the coding scripts for individual parts of MHQ2, as of now. It may be easier in the end to just paste all code into one script, when most of the reviews are done.

# Configuration of global options 

```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

# Clear global environment prior to initiation

```{r Clear global environment}
remove(list = ls())
```

# Load dependencies

Summarytools is not needed for the overarching script

```{r Load dependencies}

packages <- c("data.table", "tidyverse", "dplyr") #"summarytools"
lapply(X = packages, FUN = require, character.only = TRUE)

```

# MHQ metadata

```{r metadata}

#datasets/instruments/scripts
meta.scripts<-data.frame(matrix(data = NA,nrow = 0,ncol = 0))
meta.scripts.dependency<-data.frame(matrix(data = NA,nrow = 0,ncol = 0))


meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("SELF_REPORTED","SelfReported")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("ANXIETY","Anxiety")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("LT_DEPRESSION","MHQ2_Lifetime_Depression")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("MANIA","MHQ2_Mania_v1")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("MORE_DEPRESSION","MHQ2_More_Depression")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("AN","ED_AN_code")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("BN_PURGING","Bulimia_purging_code")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("E_BE","Extended_BE")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("BED_DSM5","BED_DSM5")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("BED_ICD11","BED_ICD11")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("PHQ9","MHQ2_PHQ9")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("SELF_HARM","self-harm_mhq2_jgm")
meta.scripts[nrow(meta.scripts)+1,c("code","filename.ex.suffix")]<-c("TRAUMA","trauma")


#dependencies between them - not sure we need this, but maybe
meta.scripts.dependency[nrow(meta.scripts.dependency)+1,c("code","dependency")]<-c("MANIA","LT_DEPRESSION")
meta.scripts.dependency[nrow(meta.scripts.dependency)+1,c("code","dependency")]<-c("POLAR_DEPRESSION","MANIA")
meta.scripts.dependency[nrow(meta.scripts.dependency)+1,c("code","dependency")]<-c("BED_DSM5","AN")

```


# Read data

All scripts must use the same variable for holding the data; MHQ2

```{r Read data, purl=FALSE}

MHQ2 <- readRDS('data/MHQ2_Anonymous.rds')

```

# Temporary hacks

```{r hacks}

MHQ2$'12144-1.0'<-169.0 #height in cm, temporary value - everybody are 169cm.

```


# Process

Process and execute all scripts from the source. These must be configured to be compatible with this process.

```{r process}

for(iDS in 1:nrow(meta.scripts)){
  #iDS <- 11 #test
  
  cCode<-meta.scripts[iDS,c("code")]
  cFilename<-meta.scripts[iDS,c("filename.ex.suffix")]
  #as R - this puts the files in the working directory root though
  knitr::purl(
    file.path("scripts",paste0(cFilename,".Rmd"))
    )
  source(
    paste0(cFilename,".R")
    )
  
  
}

#skimr::skim(MHQ2)


```


Comngratulations! Your data should be in the MHQ2 variable now.








