---
title: "MHQ2 Self-Reported Conditions"
author: "Jonathan RI Coleman"
date: "2023-11-01"
output: html_document
---

This is a script containing an algorithm for self-reported conditions from the 2023 mental wellbeing questionnaire.
These differ in several places from the equivalent items from the 2016 mental health questionnaire – these differences are listed in accompanying documentation.

# Set up

Configure global options for all chunks

```{r Setup, include=FALSE}

knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )

```

Clear global environment prior to initiation

```{r Clear global environment}

remove(list = ls())

```
# Install dependencies – SHOULD BE A MERGED TO A SINGLE LIST AND HASHED IN FINAL SCRIPT

Import package_install function

```{r Define package_install}

package_install <- function(packages){

    for(x in packages){
    
        install.packages(x, dependencies = TRUE)
	
    }	    
}

```

```{r Install dependencies - remove hashes to install}

# packages <- c("data.table","tidyverse","dplyr")
# package_install(packages)

```

# Load dependencies – NOTE THAT THESE SHOULD BE MERGED TO A SINGLE DEPENDENCIES LIST IN THE FINAL SCRIPT.

```{r Load dependencies}

packages <- c("data.table","tidyverse","dplyr")
lapply(packages, require, character.only = TRUE)

```

# Read in the data – SINGLE RUN IN THE FINAL SCRIPT

```{r Read in data}

MHQ2<-fread(args[1], data.table=F)

```

# Any self-reported diagnosis

```{r Any self-reported diagnosis}

## Disorders are coded in coding 1954: Depression (1), Mania (2), Schizophrenia (3), Other Psychosis (4)
## Disorders are coded in coding 1954: Personality disorder (5), ASD (6), ADHD (7), OCD (8),
## Disorders are coded in coding 1954: Generic anxiety (9), GAD (10), Social anxiety (11), Agoraphobia (12)
## Disorders are coded in coding 1954: Other phobias (13), Panic disorder (15), PTSD (16), AN (17)
## Disorders are coded in coding 1954: BN (18), BED (19), Other EDs (20)
## Not included are panic attacks (14)

MHQ2$SelfReportedDiagnosis <- apply(MHQ2[,grep("^29000-", colnames(MHQ2))], 1, function(row) ifelse(sum(c(1:13,15:20) %in% row) > 0, 1, 0))

```

# Any self-reported diagnosis (alternate, MHQ2016 compatible)

```{r Any self-reported diagnosis, MHQ2016 compatible}

## Disorders are coded in coding 1954: Depression (1), Mania (2), Schizophrenia (3), Other Psychosis (4)
## Disorders are coded in coding 1954: Personality disorder (5), ASD (6), ADHD (7), OCD (8),
## Disorders are coded in coding 1954: Generic anxiety (9), GAD (10), Social anxiety (11), Agoraphobia (12)
## Disorders are coded in coding 1954: Other phobias (13), Panic attacks (14), Panic disorder (15), AN (17)
## Disorders are coded in coding 1954: BN (18), BED (19)
## Not included are PTSD (16), Other EDs (20)


MHQ2$SelfReportedDiagnosisMHQ2016Compatible<- apply(MHQ2[,grep("^29000-", colnames(MHQ2))], 1, function(row) ifelse(sum(c(1:15,17:19) %in% row) > 0, 1, 0))

```

# Self-reported anxiety diagnosis

```{r Any anxiety diagnosis}

## Anxiety disorder diagnoses coded in coding 1954 are GAD (10), Social (11), Agoraphobia (12), Panic disorder (15), Other phobias (13)
## Not included are generic anxiety (9), panic attacks (14), OCD (8), and PTSD (16)

MHQ2$SelfReportedAnxietyDisorder <- apply(MHQ2[,grep("^29000-", colnames(MHQ2))], 1, function(row) ifelse(sum(c(10:13,15) %in% row) > 0, 1, 0))

```

# Self-reported eating disorder diagnosis

```{r Any eating disorder diagnosis}

## Eating disorder diagnoses coded in coding 1954 are AN (17), BN (18), BED (19), Other EDs (20)

MHQ2$SelfReportedEatingDisorder <- apply(MHQ2[,grep("^29000-", colnames(MHQ2))], 1, function(row) ifelse(sum(c(17:20) %in% row) > 0, 1, 0))

```

# Any algorithmic diagnosis

```{r Any algorithmic diagnosis}

~~TODO: This needs to be done as part of the overarching script as it relies on otuput from multiple modules~~ 

```
