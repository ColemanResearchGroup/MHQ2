---
title: "Alcohol_Cannabis_code"
author: Zhaoying YU
output: html_document
date: "2023-10-16"
---
## Set-up

```{r}
library("dplyr")
library("tidyverse")
```

## Import data
```{r}
MHQ2 <-
readRDS("/Users/lilian/Desktop/MHQ2_Anonymous.rds")
```

## Alcohol algorithms
# Adjust AUDIT score
adjusting item scores to 0-4 as indicated: 
Frequency (AUDIT1) > f.29091-0.0
scored 0-4, no adjustment needed 

Typical drinks (AUDIT 1a) > f.29092-0.0
scored 1-5, needs adjusting 

```{r}
MHQ2 <- MHQ2 %>%
  mutate('29092-0.0' = case_when(
    '29092-0.0' == 1 ~ 0,
    '29092-0.0' == 2 ~ 1,
    '29092-0.0' == 3 ~ 2,
    '29092-0.0' == 4 ~ 3,
    '29092-0.0' == 5 ~ 4,
    ))
```

Six or more drinks (AUDIT 1b) > f.29093-0.0
scored 1-5, needs adjusting 
>scores are 0, 2, 3, 4, 5. Adjusted to be 0, 1, 2, 3, 4

```{r}
MHQ2 <- MHQ2 %>%
  mutate('29093-0.0' = case_when(
    '29093-0.0' == 2 ~ 1,
    '29093-0.0' == 3 ~ 2,
    '29093-0.0' == 4 ~ 3,
    '29093-0.0' == 5 ~ 4,
    ))
```

Unable to stop (AUDIT 2) > f.29094-0.0
scored 1-5, needs adjusting
>scores are 0, 2, 3, 4, 5. Adjusted to be 0, 1, 2, 3, 4

```{r}
MHQ2 <- MHQ2 %>%
  mutate('f.29094-0.0' = case_when(
    '29094-0.0' == 2 ~ 1,
    '29094-0.0' == 3 ~ 2,
    '29094-0.0' == 4 ~ 3,
    '29094-0.0' == 5 ~ 4,
    ))
```


Failed to do what expected due to drinking (AUDIT 3) > f.29095-0.0
scored 1-5, needs adjusting
>scores are 0, 2, 3, 4, 5. Adjusted to be 0, 1, 2, 3, 4

```{r}
MHQ2 <- MHQ2 %>%
  mutate('29095-0.0' = case_when(
    '29095-0.0' == 2 ~ 1,
    '29095-0.0' == 3 ~ 2,
    '29095-0.0' == 4 ~ 3,
    '29095-0.0' == 5 ~ 4,
    ))
```

Needed to drink first thing (AUDIT 4) > f.29096-0.0
scored 1-5, needs adjusting 
>scores are 0, 2, 3, 4, 5. Adjusted to be 0, 1, 2, 3, 4

```{r}
MHQ2 <- MHQ2 %>%
  mutate('29096-0.0' = case_when(
    '29096-0.0' == 2 ~ 1,
    '29096-0.0' == 3 ~ 2,
    '29096-0.0' == 4 ~ 3,
    '29096-0.0' == 5 ~ 4,
    ))
```

Guilt due to drinking (AUDIT 5) f.29097-0.0
scored 1-5, needs adjusting
>scores are 0, 2, 3, 4, 5. Adjusted to be 0, 1, 2, 3, 4

```{r}
MHQ2 <- MHQ2 %>%
  mutate('29097-0.0' = case_when(
    '29097-0.0' == 2 ~ 1,
    '29097-0.0' == 3 ~ 2,
    '29097-0.0' == 4 ~ 3,
    '29097-0.0' == 5 ~ 4,
    ))
```

Unable to remember due to drink (AUDIT 6) f.29098-0.0
scored 1-5, needs adjusting
>scores are 0, 2, 3, 4, 5. Adjusted to be 0, 1, 2, 3, 4

```{r}
MHQ2 <- MHQ2 %>%
  mutate('29098-0.0' = case_when(
    '29098-0.0' == 2 ~ 1,
    '29098-0.0' == 3 ~ 2,
    '29098-0.0' == 4 ~ 3,
    '29098-0.0' == 5 ~ 4,
    ))
```

Injury due to drinking ever (AUDIT 7) f.29099-0.0
scored 0,1,2, needs adjusting to 0,2,4 

```{r}
MHQ2 <- MHQ2 %>%
  mutate('29099-0.0' = case_when(
    '29099-0.0' == 1 ~ 2,
    '29099-0.0' == 2 ~ 4,
    ))
```

Advice to cut down ever (AUDIT 8) f.29100-0.0
scored 0,1,2, needs adjusting to 0,2,4

```{r}
MHQ2 <- MHQ2 %>%
  mutate('29100-0.0' = case_when(
    '29100-0.0' == 1 ~ 2,
    '29100-0.0' == 2 ~ 4,
    ))
```

# Sum of AUDIT score

```{r}
MHQ2[c("29091-0.0", "29092-0.0", "29093-0.0", "29094-0.0", "29095-0.0", "29096-0.0", "29097-0.0", "29098-0.0", "29099-0.0", "29100-0.0")] <- lapply(MHQ2[c("29091-0.0", "29092-0.0", "29093-0.0", "29094-0.0", "29095-0.0", "29096-0.0", "29097-0.0", "29098-0.0", "29099-0.0", "29100-0.0")], as.numeric)
MHQ2$Sum_AUDIT <- rowSums(MHQ2[,c("29091-0.0", "29092-0.0", "29093-0.0", "29094-0.0", "29095-0.0", "29096-0.0", "29097-0.0", "29098-0.0", "29099-0.0", "29100-0.0")], na.rm = TRUE)
```

# Hazardous / harmful alcohol use (12 month) 
Score 8-15 predicts “hazardous drinking” while scores of 16 and over predict “harmful drinking” 
Hazardous alcohol use: Score {AUDIT full scale} >= 8 & <= 15 (when items scored 0-4) 
Harmful alcohol use: Score {AUDIT full scale} >= 16 (when items scored 0-4) 

```{r}
#Hazardous use
MHQ2 <- MHQ2 %>%
  mutate(alcohol_hazardous_use = case_when(
    Sum_AUDIT >= 8 & Sum_AUDIT <= 15 ~ 1,
  TRUE ~ 0
  ))

#Harmful use
MHQ2 <- MHQ2 %>%
  mutate('alcohol_harmful_use' == case_when(
    Sum_AUDIT >= 16 ~ 1,
  TRUE ~ 0
  ))
```

# Non-case for hazardous / harmful alcohol use
AUDIT full scale score under cut-off (8), excluding those who reported alcohol addiction in this questionnaire or reported at baseline they had stopped drinking due to illness, on drs advice or as a health precaution

{AUDIT score} <8

AND 
NOT {ever alcohol dependence} 
>Used data field 20117: alcohol drinker status = never. (-3) Prefer not to answer, (0) Never, (1) Previous, (2) Current
> '20117-0.0' == 0 

AND 
NOT reason for reducing amount of alcohol drunk 2664 = “ill health”, “doctor’s advice”or “health precaution” [1,2or3]
>!('2664-0.0' %in% c(1,2,3))

```{r}
MHQ2 <- MHQ2 %>%
  mutate(alcohol_nonuse = 
           case_when(
    Sum_AUDIT < 8 &
    '20117-0.0' == 0 &
    !('2664-0.0' %in% c(1,2,3))
   ~ 1,
  TRUE ~ 0
  ))
```


## Cannabis algorithms
# Cannabis use ever
Used cannabis (CU1) = Yes, 1-2 times (01) OR Yes, 3-10 times (02) OR Yes, 11-100 times (03) Yes, more than 100 times (04)
>'29104-0.0' %in% c(1,2,3,4)

```{r}
MHQ2 <- MHQ2 %>%
  mutate(cannabis_use = case_when(
   '29104-0.0' %in% c(1,2,3,4) ~ 1,
   TRUE ~ 0
  ))
```

# Daily cannabis use ever 
Maximum frequency of taking cannabis when using is every day
How often = Every day (04) 
>Every day is not 04 as suggested in algorithm, but is 3 as shown on UKbiobank showcase here:https://biobank.ndph.ox.ac.uk/showcase/coding.cgi?id=1952
>'29107-0.0' == 3

```{r}
MHQ2 <- MHQ2 %>%
  mutate(daily_cannabis_use = case_when(
   '29107-0.0' == 3 ~ 1,
   TRUE ~ 0
  ))
```