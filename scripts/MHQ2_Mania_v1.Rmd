---
title: "MHQ2 DSM5 hypo/mania"
author: "Jared G Maina"
date: "2023-10-19"
output: html_document
---

This is a script containing an algorithm for mania and hypomania based on the DSM4/5 definition. This includes likely cases of bipolar affective disorder type I, possible bipolar type II, recurrent mania without clear depression, and antidepressant-induced symptoms of hypomania / mania. Due to the low specificity of symptoms may also include normal variation

# Set up
Configure global options for all chunks
```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  comment = '',
  prompt = FALSE,
  cache = FALSE
  )
```

Clear global environment prior to initiation
```{r clear global environment}
remove(list = ls())
```

Load dependencies
```{r}
#To be updated later
#Code and adaptation to tidyverse to be refined while testing code with data
library(data.table)
library(tidyverse)
library(dplyr)
```

# Read in the data

```{r}
#To change later once I find out more about the datafile
MHQ2<-fread(args[1], data.table=F)
```

# Hypomania/Mania ever
High/Hyper=yes OR Irritable=Yes
AND
Four features from:
  High/hyper=Yes, Active, Talkative, Less sleep, Creative/ideas, Restless, Confident, Thoughts racing, Easily distracted
AND
Duration=A week or more

# Define manifestations

```{r}
MHQ2$Total.Manifestations<-0

MHQ2$Total.Manifestations<-with(MHQ2, ifelse(!is.na(`29051-0.0`) & `29051-0.0` > 0, Total.Manifestations + 1, Total.Manifestations))
MHQ2$Total.Manifestations<-with(MHQ2, ifelse(!is.na(`29051-0.1`) & `29051-0.1` > 0, Total.Manifestations + 1, Total.Manifestations))
MHQ2$Total.Manifestations<-with(MHQ2, ifelse(!is.na(`29051-0.2`) & `29051-0.2` > 0, Total.Manifestations + 1, Total.Manifestations))
MHQ2$Total.Manifestations<-with(MHQ2, ifelse(!is.na(`29051-0.3`) & `29051-0.3` > 0, Total.Manifestations + 1, Total.Manifestations))
MHQ2$Total.Manifestations<-with(MHQ2, ifelse(!is.na(`29051-0.4`) & `29051-0.4` > 0, Total.Manifestations + 1, Total.Manifestations))
MHQ2$Total.Manifestations<-with(MHQ2, ifelse(!is.na(`29051-0.5`) & `29051-0.5` > 0, Total.Manifestations + 1, Total.Manifestations))
MHQ2$Total.Manifestations<-with(MHQ2, ifelse(!is.na(`29051-0.6`) & `29051-0.6` > 0, Total.Manifestations + 1, Total.Manifestations))
MHQ2$Total.Manifestations<-with(MHQ2, ifelse(!is.na(`29051-0.7`) & `29051-0.7` > 0, Total.Manifestations + 1, Total.Manifestations))

MHQ2$Total.Manifestations<-with(MHQ2, ifelse(is.na(`29051-0.0`) | `29051-0.0` < 0, NA, Total.Manifestations))


```

```{r}
MHQ2$Hypomania.Ever <- with(MHQ2, 
  case_when(
    (is.na(`29049-0.0`) | `29049-0.0` < 0) &
      (is.na(`29050-0.0`) | `29050-0.0` < 0) &
      is.na(Total.Manifestations) &
      (is.na(`29052-0.0`) | `29052-0.0` < 0) ~ NA_real_,
    (!is.na(`29049-0.0`) & `29049-0.0` == 1 |
      (!is.na(`29050-0.0`) & `29050-0.0` == 1)) &
      Total.Manifestations >= 3 &
      !is.na(`29052-0.0`) & `29052-0.0` == 3 ~ 1,
    .default = 0
  )
)
```

# Mania ever
High/Hyper=yes OR Irritable=Yes
AND
Four features from:
  High/hyper=Yes, Active, Talkative, Less sleep, Creative/ideas, Restless, Confident, Thoughts racing, Easily distracted
AND
Duration=A week or more
AND
Needed treatment=Yes OR Caused problems=Yes

```{r}

MHQ2$Mania.Ever <- with(MHQ2, 
  ifelse(
    ((!is.na(`29049-0.0`) & `29049-0.0` == 1) | (!is.na(`29050-0.0`) & `29050-0.0` == 1)) &
    (`29049-0.0` == 1 & Total.Manifestations >= 3) &
    ((!is.na(`29052-0.0`) & `29052-0.0` == 3) & ((!is.na(`29056-0.0`) & `29056-0.0` == 1) | (!is.na(`29057-0.0`) & `29057-0.0` == 1))),
    1,
    0
  )
)

```

# Bipolar affective disorder type 1 (BD1) definition
Case(depression ever) AND symptoms (Mania ever)
```{r}

MHQ2$BD1 <- with(MHQ2,
                 ifelse(
                   (!is.na(Depressed.Ever) & Depressed.Ever ==1) & #Depressed.Ever defined elsewhere
                     (!is.na(Mania.Ever) & Mania.Ever == 1),
                   1,
                   0
                 ))
```

# Wide bipolar spectrum
Case (depression ever) AND Symptoms (hypomania/mania ever)
```{r}
MHQ2$Wider.Bipolar <- with(MHQ2,
                           ifelse(
                           (!is.na(Depressed.Ever) & Depressed.Ever == 1 ) &
                             (!is.na(Hypomania.Ever) & Hypomania.Ever == 1),
                           1, 0
                           ))
```